<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dev Digital BR - Controle de Clientes v2.0</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

  <!-- Firebase v9 -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBvos9nCRithcUX768xuwQZ70p1_xgmKOg",
      authDomain: "gestao-financeira-9e033.firebaseapp.com",
      projectId: "gestao-financeira-9e033",
      storageBucket: "gestao-financeira-9e033.firebasestorage.app",
      messagingSenderId: "694364024644",
      appId: "1:694364024644:web:1758bd0d4a47b71b93b111",
      measurementId: "G-PNL027GT4B"
    };

    let db, auth;

    try {
      firebase.initializeApp(firebaseConfig);
      db = firebase.firestore();
      auth = firebase.auth();
      
      db.settings({
        cacheSizeBytes: firebase.firestore.CACHE_SIZE_UNLIMITED
      });
      
      console.log("✅ Firebase inicializado com sucesso!");
        
    } catch (error) {
      console.error("❌ Erro na inicialização do Firebase:", error);
    }
  </script>

  <style>
    :root {
      --primary-color: #00d4ff;
      --primary-dark: #0099cc;
      --secondary-color: #0a0a0a;
      --text-light: #ffffff;
      --text-gray: #a0a0a0;
      --gradient-1: linear-gradient(135deg, #00d4ff 0%, #0099cc 50%, #0066aa 100%);
      --gradient-2: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%);
      --gradient-bg: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 50%, #0a0a0a 100%);
      --border-radius: 15px;
      --box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
      --transition: all 0.3s ease;
      --success-color: #25d366;
      --danger-color: #dc3545;
      --warning-color: #ffc107;
      --info-color: #17a2b8;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--gradient-bg);
      color: var(--text-light);
      overflow-x: hidden;
      line-height: 1.6;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .hidden { display: none !important; }

    /* Layout Vertical Estilo Desktop App */
    .app-container {
      display: flex;
      height: 100vh;
      overflow: hidden;
    }

    /* Sidebar Vertical */
    .sidebar {
      width: 280px;
      background: rgba(10,10,10,0.95);
      backdrop-filter: blur(10px);
      border-right: 1px solid rgba(255,255,255,0.1);
      display: flex;
      flex-direction: column;
      transition: var(--transition);
      position: relative;
      z-index: 1000;
    }

    .sidebar.collapsed {
      width: 80px;
    }

    /* Logo no Sidebar */
    .sidebar-header {
      padding: 1.5rem;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      display: flex;
      align-items: center;
      gap: 1rem;
      background: var(--gradient-1);
    }

    .sidebar.collapsed .sidebar-header {
      justify-content: center;
      padding: 1.5rem 0.5rem;
    }

    .logo-sidebar {
      width: 50px;
      height: 50px;
      border-radius: 12px;
      background: white;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .logo-sidebar img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    .sidebar-title {
      font-size: 1.2rem;
      font-weight: 700;
      color: var(--secondary-color);
      white-space: nowrap;
      overflow: hidden;
    }

    .sidebar.collapsed .sidebar-title {
      display: none;
    }

    /* Menu de Navegação */
    .sidebar-menu {
      flex: 1;
      overflow-y: auto;
      padding: 1rem 0;
    }

    .menu-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem 1.5rem;
      color: var(--text-light);
      text-decoration: none;
      transition: var(--transition);
      cursor: pointer;
      border-left: 3px solid transparent;
    }

    .sidebar.collapsed .menu-item {
      justify-content: center;
      padding: 1rem 0.5rem;
    }

    .menu-item:hover {
      background: rgba(0,212,255,0.1);
      border-left-color: var(--primary-color);
    }

    .menu-item.active {
      background: rgba(0,212,255,0.15);
      border-left-color: var(--primary-color);
    }

    .menu-item i {
      font-size: 1.3rem;
      width: 24px;
      text-align: center;
      flex-shrink: 0;
    }

    .menu-item span {
      font-size: 0.95rem;
      font-weight: 500;
      white-space: nowrap;
    }

    .sidebar.collapsed .menu-item span {
      display: none;
    }

    /* Botão Toggle Sidebar */
    .sidebar-toggle {
      padding: 1rem;
      border-top: 1px solid rgba(255,255,255,0.1);
      display: flex;
      justify-content: center;
    }

    .btn-toggle {
      background: rgba(0,212,255,0.1);
      border: 1px solid rgba(0,212,255,0.3);
      color: var(--primary-color);
      padding: 0.7rem 1rem;
      border-radius: 10px;
      cursor: pointer;
      transition: var(--transition);
      font-size: 1.1rem;
    }

    .btn-toggle:hover {
      background: rgba(0,212,255,0.2);
      transform: scale(1.05);
    }

    /* Área Principal de Conteúdo */
    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    /* Header Superior */
    .top-header {
      background: rgba(10,10,10,0.95);
      backdrop-filter: blur(10px);
      padding: 1rem 2rem;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 20px rgba(0,0,0,0.3);
    }

    .header-title {
      font-size: 1.5rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 0.8rem;
    }

    .header-title .highlight {
      background: var(--gradient-1);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .header-actions {
      display: flex;
      gap: 1rem;
      align-items: center;
    }

    /* Área de Conteúdo Scrollável */
    .content-area {
      flex: 1;
      overflow-y: auto;
      padding: 2rem;
    }

    /* Container Principal */
    .container { 
      max-width: 1400px; 
      margin: 0 auto;
    }

    /* Cards */
    .card {
      background: var(--gradient-2);
      border-radius: 20px;
      padding: 2rem;
      margin-bottom: 2rem;
      border: 1px solid rgba(255,255,255,0.1);
      box-shadow: var(--box-shadow);
      backdrop-filter: blur(10px);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    .card-title {
      font-size: 1.3rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.7rem;
    }

    /* Formulário */
    .form-section {
      margin-bottom: 2rem;
    }

    .section-title {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--primary-color);
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding-bottom: 0.5rem;
      border-bottom: 2px solid rgba(0,212,255,0.2);
    }

    .form-group { 
      margin-bottom: 1.5rem; 
      text-align: left; 
    }
    
    .form-group label { 
      display: block; 
      margin-bottom: 0.5rem; 
      color: var(--text-light); 
      font-weight: 600;
      font-size: 0.9rem;
    }
    
    .form-group label .optional { 
      color: var(--text-gray); 
      font-weight: 400; 
      font-size: 0.85rem;
      font-style: italic;
    }
    
    .form-control {
      width: 100%; 
      padding: 1rem;
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 12px;
      background: rgba(255,255,255,0.05);
      color: var(--text-light);
      font-size: 1rem;
      transition: var(--transition);
      backdrop-filter: blur(10px);
    }
    
    .form-control:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 2px rgba(0,212,255,0.2);
      background: rgba(255,255,255,0.08);
    }
    
    .form-control::placeholder { 
      color: var(--text-gray); 
    }

    select.form-control option {
      background: rgba(26, 26, 26, 0.98);
      color: var(--text-light);
      padding: 10px;
    }

    .form-row { 
      display: grid; 
      grid-template-columns: 1fr 1fr; 
      gap: 1rem; 
      margin-bottom: 1.5rem; 
    }
    
    .form-row-3 { 
      display: grid; 
      grid-template-columns: 1fr 1fr 1fr; 
      gap: 1rem; 
      margin-bottom: 1.5rem; 
    }

    .form-row-4 { 
      display: grid; 
      grid-template-columns: 1fr 1fr 1fr 1fr; 
      gap: 1rem; 
      margin-bottom: 1.5rem; 
    }

    /* Botões */
    .btn {
      padding: 1rem 2rem;
      border: none;
      border-radius: 50px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      text-decoration: none;
    }

    .btn:disabled { 
      opacity: 0.6; 
      cursor: not-allowed; 
    }
    
    .btn-primary { 
      background: var(--gradient-1); 
      color: var(--secondary-color); 
    }
    
    .btn-success { 
      background: var(--success-color); 
      color: var(--text-light); 
    }
    
    .btn-danger { 
      background: var(--danger-color); 
      color: var(--text-light); 
    }
    
    .btn-warning { 
      background: var(--warning-color); 
      color: var(--secondary-color); 
    }
    
    .btn-info { 
      background: var(--info-color); 
      color: var(--text-light); 
    }
    
    .btn-small { 
      padding: 0.5rem 1rem; 
      font-size: 0.9rem; 
      border-radius: 20px; 
    }
    
    .btn:hover:not(:disabled) { 
      transform: translateY(-2px); 
      box-shadow: 0 10px 30px rgba(0,0,0,0.3); 
    }

    /* Continue na PARTE 2... */
  /* Seção de Filtros */
    .filters-section {
      background: var(--gradient-2);
      padding: 1.5rem;
      border-radius: 20px;
      border: 1px solid rgba(255,255,255,0.1);
      margin-bottom: 2rem;
      display: flex;
      gap: 1rem;
      align-items: end;
      flex-wrap: wrap;
    }

    .filter-group { 
      flex: 1; 
      min-width: 200px; 
    }
    
    .filter-group label {
      display: block;
      margin-bottom: 0.5rem;
      color: var(--text-light);
      font-weight: 600;
      font-size: 0.9rem;
    }

    .search-box {
      display: flex;
      gap: 0.5rem;
      flex: 2;
      min-width: 300px;
    }

    /* Estatísticas */
    .stats-grid { 
      display: grid; 
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
      gap: 1.5rem; 
      margin-bottom: 2rem; 
    }
    
    .stats-card {
      background: var(--gradient-2);
      padding: 1.5rem;
      border-radius: 20px;
      text-align: center;
      border: 1px solid rgba(255,255,255,0.1);
      position: relative;
      overflow: hidden;
      transition: var(--transition);
    }
    
    .stats-card::before { 
      content: ''; 
      position: absolute; 
      top: 0; 
      left: 0; 
      right: 0; 
      height: 4px; 
      background: var(--gradient-1); 
    }
    
    .stats-card:hover { 
      transform: translateY(-5px); 
      box-shadow: 0 20px 40px rgba(0,0,0,0.4); 
    }
    
    .stats-card.success::before { 
      background: var(--success-color); 
    }
    
    .stats-card.warning::before { 
      background: var(--warning-color); 
    }
    
    .stats-card.danger::before { 
      background: var(--danger-color); 
    }

    .stats-icon { 
      font-size: 2rem; 
      margin-bottom: 0.5rem; 
      color: var(--primary-color); 
    }
    
    .stats-card.success .stats-icon { 
      color: var(--success-color); 
    }
    
    .stats-card.warning .stats-icon { 
      color: var(--warning-color); 
    }
    
    .stats-card.danger .stats-icon { 
      color: var(--danger-color); 
    }
    
    .stats-value { 
      font-size: 1.8rem; 
      font-weight: 700; 
      color: var(--text-light); 
    }
    
    .stats-label {
      font-size: 0.9rem;
      color: var(--text-gray);
      margin-top: 0.5rem;
    }

    /* Tabela */
    .table-container { 
      overflow-x: auto; 
      border-radius: var(--border-radius); 
    }
    
    .table { 
      width: 100%; 
      border-collapse: collapse; 
      background: rgba(255,255,255,0.02); 
      border-radius: var(--border-radius); 
      overflow: hidden; 
    }
    
    .table thead { 
      background: var(--gradient-1); 
    }
    
    .table th { 
      padding: 1rem; 
      text-align: left; 
      font-weight: 600; 
      color: var(--secondary-color); 
      font-size: 0.95rem; 
    }
    
    .table td { 
      padding: 1rem; 
      text-align: left; 
      border-bottom: 1px solid rgba(255,255,255,0.1); 
      color: var(--text-light); 
    }
    
    .table tbody tr { 
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
      position: relative; 
    }
    
    .table tbody tr:hover { 
      background: rgba(0,212,255,0.08); 
    }
    
    .table tbody tr:nth-child(even) {
      background: rgba(255,255,255,0.02);
    }

    /* Badges de Status */
    .status-badge { 
      padding: 0.4rem 1rem; 
      border-radius: 20px; 
      font-size: 0.85rem; 
      font-weight: 600; 
      text-transform: uppercase; 
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
    }
    
    .status-badge.pago { 
      background: rgba(37,211,102,0.2); 
      color: var(--success-color); 
      border: 1px solid rgba(37,211,102,0.3); 
    }
    
    .status-badge.pendente { 
      background: rgba(255,193,7,0.2); 
      color: var(--warning-color); 
      border: 1px solid rgba(255,193,7,0.3); 
    }
    
    .status-badge.atrasado { 
      background: rgba(220,53,69,0.2); 
      color: var(--danger-color); 
      border: 1px solid rgba(220,53,69,0.3); 
    }

    /* Ações da Tabela */
    .action-buttons {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    /* Estado Vazio */
    .empty-state { 
      text-align: center; 
      padding: 3rem; 
      color: var(--text-gray); 
    }
    
    .empty-state i { 
      font-size: 4rem; 
      margin-bottom: 1rem; 
      color: var(--primary-color); 
      opacity: 0.5; 
    }

    /* Toast Notifications */
    .toast-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 9999;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .toast {
      min-width: 350px;
      padding: 15px 20px;
      border-radius: 12px;
      color: white;
      font-weight: 600;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
      backdrop-filter: blur(10px);
      transform: translateX(400px);
      opacity: 0;
      transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      display: flex;
      align-items: center;
      gap: 12px;
      border-left: 4px solid;
    }

    .toast.show { 
      transform: translateX(0); 
      opacity: 1; 
    }
    
    .toast.success { 
      background: linear-gradient(135deg, rgba(37, 211, 102, 0.95), rgba(25, 135, 84, 0.95)); 
      border-left-color: var(--success-color); 
    }
    
    .toast.error { 
      background: linear-gradient(135deg, rgba(220, 53, 69, 0.95), rgba(176, 42, 55, 0.95)); 
      border-left-color: var(--danger-color); 
    }
    
    .toast.warning { 
      background: linear-gradient(135deg, rgba(255, 193, 7, 0.95), rgba(255, 143, 0, 0.95)); 
      border-left-color: var(--warning-color); 
      color: var(--secondary-color); 
    }
    
    .toast.info { 
      background: linear-gradient(135deg, rgba(23, 162, 184, 0.95), rgba(13, 110, 253, 0.95)); 
      border-left-color: var(--info-color); 
    }

    .toast .toast-close {
      margin-left: auto; 
      background: none; 
      border: none; 
      color: inherit;
      font-size: 1.1rem; 
      cursor: pointer; 
      opacity: 0.7; 
      padding: 0;
      width: 20px; 
      height: 20px; 
      display: flex; 
      align-items: center;
      justify-content: center; 
      transition: opacity 0.2s;
    }
    
    .toast .toast-close:hover { 
      opacity: 1; 
    }

    .loading { 
      display: flex; 
      justify-content: center; 
      align-items: center; 
      padding: 2rem; 
      color: var(--text-gray); 
    }
    
    .loading i { 
      animation: spin 1s linear infinite; 
      margin-right: 0.5rem; 
    }

    .connection-status {
      position: fixed;
      bottom: 20px;
      left: 20px;
      padding: 0.7rem 1.2rem;
      border-radius: 25px;
      font-size: 0.85rem;
      font-weight: 600;
      z-index: 1000;
      backdrop-filter: blur(10px);
      border: 1px solid;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      transition: var(--transition);
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    }

    .connection-status.connected { 
      background: rgba(37, 211, 102, 0.2); 
      color: var(--success-color); 
      border-color: rgba(37, 211, 102, 0.3); 
    }
    
    .connection-status.disconnected { 
      background: rgba(220, 53, 69, 0.2); 
      color: var(--danger-color); 
      border-color: rgba(220, 53, 69, 0.3); 
    }

    /* Lista de Clientes para Seleção */
    .cliente-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }

    .cliente-card {
      background: rgba(255,255,255,0.05);
      border: 2px solid rgba(255,255,255,0.1);
      border-radius: 15px;
      padding: 1.2rem;
      cursor: pointer;
      transition: var(--transition);
      position: relative;
    }

    .cliente-card:hover {
      background: rgba(0,212,255,0.1);
      border-color: var(--primary-color);
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(0,212,255,0.2);
    }

    .cliente-card.selected {
      background: rgba(0,212,255,0.15);
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(0,212,255,0.3);
    }

    .cliente-card-header {
      display: flex;
      justify-content: space-between;
      align-items: start;
      margin-bottom: 0.8rem;
    }

    .cliente-card-title {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--text-light);
    }

    .cliente-card-empresa {
      font-size: 0.9rem;
      color: var(--text-gray);
      margin-bottom: 0.5rem;
    }

    .cliente-card-info {
      display: flex;
      flex-direction: column;
      gap: 0.3rem;
      font-size: 0.85rem;
      color: var(--text-gray);
    }

    .selected-badge {
      position: absolute;
      top: 10px;
      right: 10px;
      background: var(--success-color);
      color: white;
      padding: 0.3rem 0.8rem;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }

    /* Views/Telas */
    .view {
      display: none;
    }

    .view.active {
      display: block;
      animation: fadeInUp 0.5s ease-out;
    }

    /* Animações */
    @keyframes fadeInUp { 
      from {
        opacity: 0; 
        transform: translateY(30px);
      } 
      to {
        opacity: 1; 
        transform: translateY(0);
      } 
    }
    
    @keyframes spin { 
      0% { transform: rotate(0deg); } 
      100% { transform: rotate(360deg); } 
    }
    
    .fade-in { 
      animation: fadeInUp 0.6s ease-out; 
    }

    /* Continue na PARTE 3 com RESPONSIVIDADE... */
    /* ========================================
       RESPONSIVIDADE MOBILE
       ======================================== */

    /* Mobile Menu Toggle (NOVO!) */
    .mobile-menu-toggle {
      position: fixed;
      top: 15px;
      left: 15px;
      z-index: 1001;
      background: var(--gradient-1);
      border: none;
      width: 50px;
      height: 50px;
      border-radius: 12px;
      color: var(--secondary-color);
      font-size: 1.3rem;
      cursor: pointer;
      display: none;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 15px rgba(0, 212, 255, 0.4);
      transition: var(--transition);
    }

    .mobile-menu-toggle:active {
      transform: scale(0.95);
    }

    /* Overlay para fechar menu mobile */
    .sidebar-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.7);
      z-index: 999;
      backdrop-filter: blur(5px);
    }

    @media (max-width: 768px) {
      /* Mostra botão do menu mobile */
      .mobile-menu-toggle {
        display: flex;
      }

      /* Sidebar vira menu lateral mobile */
      .sidebar {
        position: fixed;
        top: 0;
        left: -280px;
        height: 100vh;
        z-index: 1000;
        transition: left 0.3s ease;
      }

      .sidebar.mobile-open {
        left: 0;
      }

      .sidebar.collapsed {
        left: -280px;
        width: 280px;
      }

      .sidebar-overlay.active {
        display: block;
      }

      /* Ajusta conteúdo principal */
      .main-content {
        width: 100%;
      }

      .top-header {
        padding: 1rem;
        padding-left: 75px;
      }

      .header-title {
        font-size: 1.2rem;
      }

      .header-actions {
        gap: 0.5rem;
      }

      .content-area {
        padding: 1rem;
      }

      .container {
        padding: 0;
      }

      /* Cards menores */
      .card {
        padding: 1.2rem;
        margin-bottom: 1.5rem;
      }

      .card-title {
        font-size: 1.1rem;
      }

      /* Formulários em coluna única */
      .form-row,
      .form-row-3,
      .form-row-4 {
        grid-template-columns: 1fr;
      }

      /* Estatísticas em coluna */
      .stats-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
      }

      /* Filtros em coluna */
      .filters-section {
        flex-direction: column;
        padding: 1rem;
      }

      .filter-group,
      .search-box {
        min-width: 100%;
      }

      /* Tabela responsiva */
      .table {
        font-size: 0.85rem;
      }

      .table th,
      .table td {
        padding: 0.6rem 0.4rem;
      }

      /* Botões de ação em coluna */
      .action-buttons {
        flex-direction: column;
        gap: 0.3rem;
      }

      .btn-small {
        width: 100%;
        justify-content: center;
      }

      /* Toast menor */
      .toast {
        min-width: auto;
        width: calc(100% - 40px);
        left: 20px;
        right: 20px;
      }

      .toast-container {
        left: 0;
        right: 0;
        padding: 0 20px;
      }

      /* Lista de clientes */
      .cliente-list {
        grid-template-columns: 1fr;
      }

      /* Ajusta botões */
      .btn {
        padding: 0.8rem 1.5rem;
        font-size: 0.9rem;
      }

      /* Connection status */
      .connection-status {
        bottom: 10px;
        left: 10px;
        font-size: 0.75rem;
        padding: 0.5rem 0.8rem;
      }

      /* Esconde textos longos em mobile */
      .hide-mobile {
        display: none;
      }
    }

    /* Tablets */
    @media (min-width: 769px) and (max-width: 1024px) {
      .sidebar {
        width: 240px;
      }

      .sidebar.collapsed {
        width: 70px;
      }

      .content-area {
        padding: 1.5rem;
      }

      .form-row-3,
      .form-row-4 {
        grid-template-columns: 1fr 1fr;
      }

      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .cliente-list {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    /* Desktop grande */
    @media (min-width: 1400px) {
      .container {
        max-width: 1600px;
      }

      .stats-grid {
        grid-template-columns: repeat(4, 1fr);
      }
    }
  </style>
</head>
<body>
  <!-- Container de Notificações -->
  <div class="toast-container" id="toast-container"></div>

  <!-- Status de Conexão -->
  <div id="connection-status" class="connection-status">
    <i class="fas fa-wifi"></i>
    <span>Verificando conexão...</span>
  </div>

  <!-- Botão Menu Mobile -->
  <button class="mobile-menu-toggle" id="mobile-menu-toggle">
    <i class="fas fa-bars"></i>
  </button>

  <!-- Overlay Mobile -->
  <div class="sidebar-overlay" id="sidebar-overlay"></div>

  <!-- Container Principal da Aplicação -->
  <div class="app-container">
    
    <!-- Sidebar Lateral -->
    <aside class="sidebar" id="sidebar">
      <!-- Header do Sidebar -->
      <div class="sidebar-header">
        <div class="logo-sidebar">
          <img src="logo_nome.png" alt="Dev Digital BR Logo">
        </div>
        <div class="sidebar-title">Dev Digital BR</div>
      </div>

      <!-- Menu de Navegação -->
      <nav class="sidebar-menu">
        <a class="menu-item active" data-view="dashboard">
          <i class="fas fa-home"></i>
          <span>Dashboard</span>
        </a>
        <a class="menu-item" data-view="cadastrar-cliente">
          <i class="fas fa-user-plus"></i>
          <span>Cadastrar Cliente</span>
        </a>
        <a class="menu-item" data-view="nova-cobranca">
          <i class="fas fa-file-invoice-dollar"></i>
          <span>Nova Cobrança</span>
        </a>
        <a class="menu-item" data-view="lista-clientes">
          <i class="fas fa-users"></i>
          <span>Lista de Clientes</span>
        </a>
        <a class="menu-item" data-view="cobrancas">
          <i class="fas fa-money-bill-wave"></i>
          <span>Cobranças</span>
        </a>
        <a href="finance.html" class="menu-item">
          <i class="fas fa-chart-line"></i>
          <span>Painel Financeiro</span>
        </a>
      </nav>

      <!-- Toggle Sidebar -->
      <div class="sidebar-toggle">
        <button class="btn-toggle" id="sidebar-toggle-btn">
          <i class="fas fa-angle-left"></i>
        </button>
      </div>
    </aside>

    <!-- Área Principal de Conteúdo -->
    <main class="main-content">
      <!-- Header Superior -->
      <header class="top-header">
        <div class="header-title">
          <i class="fas fa-users"></i>
          <span>Controle de <span class="highlight">Clientes</span></span>
        </div>
        <div class="header-actions">
          <button class="btn btn-primary btn-small" onclick="voltarParaPainel()">
            <i class="fas fa-arrow-left"></i>
            <span class="hide-mobile">Voltar</span>
          </button>
        </div>
      </header>

      <!-- Área de Conteúdo Scrollável -->
      <div class="content-area">
        <div class="container">
          
          <!-- Loading State -->
          <div id="loading-state" class="loading hidden">
            <i class="fas fa-spinner"></i> Carregando dados...
          </div>

          <!-- VIEW 1: DASHBOARD -->
          <div id="view-dashboard" class="view active">
            <h2 class="card-title fade-in">
              <i class="fas fa-chart-bar"></i>
              Visão Geral do Sistema
            </h2>

            <!-- Cards de Estatísticas -->
            <div class="stats-grid fade-in">
              <div class="stats-card">
                <i class="fas fa-users stats-icon"></i>
                <div class="stats-value" id="total-clientes">0</div>
                <div class="stats-label">Total de Clientes</div>
              </div>
              <div class="stats-card success">
                <i class="fas fa-check-circle stats-icon"></i>
                <div class="stats-value" id="clientes-pagos">0</div>
                <div class="stats-label">Pagamentos em Dia</div>
              </div>
              <div class="stats-card warning">
                <i class="fas fa-clock stats-icon"></i>
                <div class="stats-value" id="clientes-pendentes">0</div>
                <div class="stats-label">Vencendo em Breve</div>
              </div>
              <div class="stats-card danger">
                <i class="fas fa-exclamation-circle stats-icon"></i>
                <div class="stats-value" id="clientes-atrasados">0</div>
                <div class="stats-label">Pagamentos Atrasados</div>
              </div>
            </div>

            <!-- Ações Rápidas -->
            <div class="card fade-in">
              <div class="card-header">
                <h3 class="card-title">
                  <i class="fas fa-bolt"></i>
                  Ações Rápidas
                </h3>
              </div>
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                <button class="btn btn-success" onclick="mudarView('cadastrar-cliente')">
                  <i class="fas fa-user-plus"></i>
                  Novo Cliente
                </button>
                <button class="btn btn-primary" onclick="mudarView('nova-cobranca')">
                  <i class="fas fa-file-invoice-dollar"></i>
                  Nova Cobrança
                </button>
                <button class="btn btn-info" onclick="mudarView('lista-clientes')">
                  <i class="fas fa-list"></i>
                  Ver Clientes
                </button>
                <button class="btn btn-warning" onclick="mudarView('cobrancas')">
                  <i class="fas fa-money-bill-wave"></i>
                  Ver Cobranças
                </button>
              </div>
            </div>
          </div>

          <!-- VIEW 2: CADASTRAR CLIENTE -->
          <div id="view-cadastrar-cliente" class="view">
            <div class="card fade-in">
              <div class="card-header">
                <h3 class="card-title">
                  <i class="fas fa-user-plus"></i>
                  <span id="form-cliente-title">Cadastrar Novo Cliente</span>
                </h3>
              </div>

              <form id="cliente-form">
                <input type="hidden" id="cliente-id">

                <!-- Seção 1: Informações Básicas -->
                <div class="form-section">
                  <h4 class="section-title">
                    <i class="fas fa-user"></i>
                    Informações Básicas
                  </h4>

                  <div class="form-row">
                    <div class="form-group">
                      <label for="nome">Nome do Cliente *</label>
                      <input type="text" id="nome" class="form-control" placeholder="João Silva" required>
                    </div>
                    <div class="form-group">
                      <label for="empresa">Nome da Empresa *</label>
                      <input type="text" id="empresa" class="form-control" placeholder="Empresa XYZ Ltda" required>
                    </div>
                  </div>

                  <div class="form-row">
                    <div class="form-group">
                      <label for="cpf-cnpj">CPF/CNPJ <span class="optional">(opcional)</span></label>
                      <input type="text" id="cpf-cnpj" class="form-control" placeholder="000.000.000-00 ou 00.000.000/0000-00">
                    </div>
                    <div class="form-group">
                      <label for="segmento">Segmento da Empresa <span class="optional">(opcional)</span></label>
                      <input type="text" id="segmento" class="form-control" placeholder="Ex: Tecnologia, Varejo, Saúde">
                    </div>
                  </div>
                </div>

                <!-- Seção 2: Contato -->
                <div class="form-section">
                  <h4 class="section-title">
                    <i class="fas fa-address-book"></i>
                    Informações de Contato
                  </h4>

                  <div class="form-row">
                    <div class="form-group">
                      <label for="telefone">Telefone / WhatsApp *</label>
                      <input type="tel" id="telefone" class="form-control" placeholder="(11) 98765-4321" required>
                    </div>
                    <div class="form-group">
                      <label for="email">E-mail <span class="optional">(opcional)</span></label>
                      <input type="email" id="email" class="form-control" placeholder="cliente@empresa.com">
                    </div>
                  </div>
                </div>

                <!-- Seção 3: Endereço -->
                <div class="form-section">
                  <h4 class="section-title">
                    <i class="fas fa-map-marker-alt"></i>
                    Endereço <span class="optional" style="color: var(--text-gray); font-size: 0.9rem;">(todos os campos são opcionais)</span>
                  </h4>

                  <div class="form-row">
                    <div class="form-group">
                      <label for="cep">CEP <span class="optional">(opcional)</span></label>
                      <input type="text" id="cep" class="form-control" placeholder="00000-000">
                    </div>
                    <div class="form-group">
                      <label for="rua">Rua <span class="optional">(opcional)</span></label>
                      <input type="text" id="rua" class="form-control" placeholder="Rua das Flores">
                    </div>
                  </div>

                  <div class="form-row-3">
                    <div class="form-group">
                      <label for="numero">Número <span class="optional">(opcional)</span></label>
                      <input type="text" id="numero" class="form-control" placeholder="123">
                    </div>
                    <div class="form-group">
                      <label for="bairro">Bairro <span class="optional">(opcional)</span></label>
                      <input type="text" id="bairro" class="form-control" placeholder="Centro">
                    </div>
                    <div class="form-group">
                      <label for="cidade">Cidade <span class="optional">(opcional)</span></label>
                      <input type="text" id="cidade" class="form-control" placeholder="São Paulo">
                    </div>
                  </div>

                  <div class="form-row">
                    <div class="form-group">
                      <label for="estado">Estado <span class="optional">(opcional)</span></label>
                      <select id="estado" class="form-control">
                        <option value="">Selecione...</option>
                        <option value="AC">Acre</option>
                        <option value="AL">Alagoas</option>
                        <option value="AP">Amapá</option>
                        <option value="AM">Amazonas</option>
                        <option value="BA">Bahia</option>
                        <option value="CE">Ceará</option>
                        <option value="DF">Distrito Federal</option>
                        <option value="ES">Espírito Santo</option>
                        <option value="GO">Goiás</option>
                        <option value="MA">Maranhão</option>
                        <option value="MT">Mato Grosso</option>
                        <option value="MS">Mato Grosso do Sul</option>
                        <option value="MG">Minas Gerais</option>
                        <option value="PA">Pará</option>
                        <option value="PB">Paraíba</option>
                        <option value="PR">Paraná</option>
                        <option value="PE">Pernambuco</option>
                        <option value="PI">Piauí</option>
                        <option value="RJ">Rio de Janeiro</option>
                        <option value="RN">Rio Grande do Norte</option>
                        <option value="RS">Rio Grande do Sul</option>
                        <option value="RO">Rondônia</option>
                        <option value="RR">Roraima</option>
                        <option value="SC">Santa Catarina</option>
                        <option value="SP">São Paulo</option>
                        <option value="SE">Sergipe</option>
                        <option value="TO">Tocantins</option>
                      </select>
                    </div>
                  </div>
                </div>

                <!-- Seção 4: Observações -->
                <div class="form-section">
                  <h4 class="section-title">
                    <i class="fas fa-sticky-note"></i>
                    Observações Adicionais
                  </h4>

                  <div class="form-group">
                    <label for="observacoes">Observações <span class="optional">(opcional)</span></label>
                    <textarea id="observacoes" class="form-control" rows="3" placeholder="Informações adicionais sobre o cliente..."></textarea>
                  </div>
                </div>

                <!-- Botões de Ação -->
                <div style="display: flex; gap: 1rem; justify-content: flex-end; flex-wrap: wrap;">
                  <button type="button" class="btn btn-danger" id="cancel-cliente-btn" style="display: none;">
                    <i class="fas fa-times"></i> Cancelar
                  </button>
                  <button type="submit" class="btn btn-success" id="submit-cliente-btn">
                    <i class="fas fa-check"></i> Cadastrar Cliente
                  </button>
                </div>
              </form>
            </div>
          </div>

          <!-- As próximas VIEWS continuam na PARTE 5... -->
           <!-- VIEW 3: NOVA COBRANÇA -->
          <div id="view-nova-cobranca" class="view">
            <div class="card fade-in">
              <div class="card-header">
                <h3 class="card-title">
                  <i class="fas fa-file-invoice-dollar"></i>
                  Nova Cobrança
                </h3>
              </div>

              <!-- Passo 1: Selecionar Cliente -->
              <div id="step-selecionar-cliente">
                <h4 class="section-title">
                  <i class="fas fa-user-check"></i>
                  Passo 1: Selecione o Cliente
                </h4>

                <!-- Busca de Cliente -->
                <div class="form-group">
                  <label for="search-cliente-cobranca">Buscar Cliente</label>
                  <div style="display: flex; gap: 0.5rem;">
                    <input type="text" id="search-cliente-cobranca" class="form-control" placeholder="Digite o nome ou empresa do cliente...">
                    <button class="btn btn-primary btn-small" onclick="buscarClientesParaCobranca()">
                      <i class="fas fa-search"></i>
                    </button>
                  </div>
                </div>

                <!-- Lista de Clientes -->
                <div id="clientes-para-cobranca" class="cliente-list">
                  <!-- Preenchido dinamicamente -->
                </div>

                <div id="empty-clientes-cobranca" class="empty-state hidden">
                  <i class="fas fa-users-slash"></i>
                  <h3>Nenhum cliente encontrado</h3>
                  <p>Cadastre clientes primeiro para criar cobranças.</p>
                  <button class="btn btn-success" onclick="mudarView('cadastrar-cliente')">
                    <i class="fas fa-user-plus"></i>
                    Cadastrar Novo Cliente
                  </button>
                </div>
              </div>

              <!-- Passo 2: Dados da Cobrança (inicialmente oculto) -->
              <div id="step-dados-cobranca" class="hidden">
                <h4 class="section-title">
                  <i class="fas fa-money-check-alt"></i>
                  Passo 2: Dados da Cobrança
                </h4>

                <!-- Info do Cliente Selecionado -->
                <div style="background: rgba(0,212,255,0.1); border: 1px solid rgba(0,212,255,0.3); border-radius: 12px; padding: 1rem; margin-bottom: 1.5rem;">
                  <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                      <strong style="color: var(--primary-color);">Cliente Selecionado:</strong>
                      <div id="cliente-selecionado-info" style="margin-top: 0.5rem; color: var(--text-light);"></div>
                    </div>
                    <button class="btn btn-warning btn-small" onclick="voltarSelecaoCliente()">
                      <i class="fas fa-undo"></i>
                      Trocar Cliente
                    </button>
                  </div>
                </div>

                <form id="cobranca-form">
                  <input type="hidden" id="cobranca-cliente-id">
                  <input type="hidden" id="cobranca-id">

                  <div class="form-row-3">
                    <div class="form-group">
                      <label for="cobranca-servico">Serviço Prestado *</label>
                      <input type="text" id="cobranca-servico" class="form-control" placeholder="Desenvolvimento de Site" required>
                    </div>
                    <div class="form-group">
                      <label for="cobranca-valor">Valor (R$) *</label>
                      <input type="number" id="cobranca-valor" class="form-control" placeholder="0,00" step="0.01" min="0" required>
                    </div>
                    <div class="form-group">
                      <label for="cobranca-vencimento">Data de Vencimento *</label>
                      <input type="date" id="cobranca-vencimento" class="form-control" required>
                    </div>
                  </div>

                  <div class="form-row">
                    <div class="form-group">
                      <label for="cobranca-forma-pagamento">Forma de Pagamento *</label>
                      <select id="cobranca-forma-pagamento" class="form-control" required>
                        <option value="">Selecione...</option>
                        <option value="pix">PIX</option>
                        <option value="cartao-credito">Cartão de Crédito</option>
                        <option value="cartao-debito">Cartão de Débito</option>
                        <option value="boleto">Boleto</option>
                        <option value="dinheiro">Dinheiro</option>
                        <option value="transferencia">Transferência Bancária</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label for="cobranca-status">Status do Pagamento *</label>
                      <select id="cobranca-status" class="form-control" required>
                        <option value="pendente">Pendente</option>
                        <option value="pago">Pago</option>
                        <option value="atrasado">Atrasado</option>
                      </select>
                    </div>
                  </div>

                  <div class="form-group">
                    <label for="cobranca-observacoes">Observações <span class="optional">(opcional)</span></label>
                    <textarea id="cobranca-observacoes" class="form-control" rows="3" placeholder="Detalhes sobre a cobrança..."></textarea>
                  </div>

                  <!-- Botões de Ação -->
                  <div style="display: flex; gap: 1rem; justify-content: flex-end; flex-wrap: wrap;">
                    <button type="button" class="btn btn-danger" onclick="cancelarCobranca()">
                      <i class="fas fa-times"></i> Cancelar
                    </button>
                    <button type="submit" class="btn btn-success" id="submit-cobranca-btn">
                      <i class="fas fa-check"></i> Criar Cobrança
                    </button>
                  </div>
                </form>
              </div>
            </div>
          </div>

          <!-- VIEW 4: LISTA DE CLIENTES -->
          <div id="view-lista-clientes" class="view">
            <!-- Filtros -->
            <div class="filters-section fade-in">
              <div class="search-box" style="flex: 1;">
                <input type="text" id="search-clientes-lista" class="form-control" placeholder="Buscar por nome ou empresa...">
                <button class="btn btn-primary btn-small" onclick="buscarClientesLista()">
                  <i class="fas fa-search"></i>
                </button>
              </div>
            </div>

            <!-- Tabela de Clientes -->
            <div class="card fade-in">
              <div class="card-header">
                <h3 class="card-title">
                  <i class="fas fa-users"></i>
                  Todos os Clientes Cadastrados
                </h3>
                <button class="btn btn-success btn-small" onclick="mudarView('cadastrar-cliente')">
                  <i class="fas fa-plus"></i>
                  Novo Cliente
                </button>
              </div>

              <div class="table-container">
                <table class="table" id="clientes-lista-table">
                  <thead>
                    <tr>
                      <th>Nome</th>
                      <th>Empresa</th>
                      <th>CPF/CNPJ</th>
                      <th>Telefone</th>
                      <th>E-mail</th>
                      <th>Cidade/Estado</th>
                      <th>Ações</th>
                    </tr>
                  </thead>
                  <tbody id="clientes-lista-tbody"></tbody>
                </table>
                <div id="empty-clientes-lista" class="empty-state hidden">
                  <i class="fas fa-user-slash"></i>
                  <h3>Nenhum cliente cadastrado</h3>
                  <p>Comece cadastrando seu primeiro cliente.</p>
                  <button class="btn btn-success" onclick="mudarView('cadastrar-cliente')">
                    <i class="fas fa-user-plus"></i>
                    Cadastrar Primeiro Cliente
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- VIEW 5: COBRANÇAS -->
          <div id="view-cobrancas" class="view">
            <!-- Filtros de Cobranças -->
            <div class="filters-section fade-in">
              <div class="filter-group">
                <label for="filter-status-cobranca">Filtrar por Status</label>
                <select id="filter-status-cobranca" class="form-control" onchange="filtrarCobrancas()">
                  <option value="">Todos</option>
                  <option value="pago">Pagos</option>
                  <option value="pendente">Pendentes</option>
                  <option value="atrasado">Atrasados</option>
                </select>
              </div>
              <div class="search-box">
                <input type="text" id="search-cobrancas" class="form-control" placeholder="Buscar por cliente ou serviço...">
                <button class="btn btn-primary btn-small" onclick="buscarCobrancas()">
                  <i class="fas fa-search"></i>
                </button>
              </div>
            </div>

            <!-- Tabela de Cobranças -->
            <div class="card fade-in">
              <div class="card-header">
                <h3 class="card-title">
                  <i class="fas fa-money-bill-wave"></i>
                  Todas as Cobranças
                </h3>
                <button class="btn btn-primary btn-small" onclick="mudarView('nova-cobranca')">
                  <i class="fas fa-plus"></i>
                  Nova Cobrança
                </button>
              </div>

              <div class="table-container">
                <table class="table" id="cobrancas-table">
                  <thead>
                    <tr>
                      <th>Cliente</th>
                      <th>Empresa</th>
                      <th>Serviço</th>
                      <th>Valor</th>
                      <th>Pagamento</th>
                      <th>Vencimento</th>
                      <th>Status</th>
                      <th>Ações</th>
                    </tr>
                  </thead>
                  <tbody id="cobrancas-tbody"></tbody>
                </table>
                <div id="empty-cobrancas" class="empty-state hidden">
                  <i class="fas fa-file-invoice-dollar"></i>
                  <h3>Nenhuma cobrança registrada</h3>
                  <p>Crie sua primeira cobrança para um cliente.</p>
                  <button class="btn btn-primary" onclick="mudarView('nova-cobranca')">
                    <i class="fas fa-plus"></i>
                    Criar Primeira Cobrança
                  </button>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>
    </main>
  </div>

  <!-- O JavaScript começa na PARTE 6 -->
   <script>
    // ========================================
    // VARIÁVEIS GLOBAIS
    // ========================================
    let clientes = [];
    let cobrancas = [];
    let filteredClientes = [];
    let filteredCobrancas = [];
    let clienteEditando = null;
    let cobrancaEditando = null;
    let clienteSelecionadoParaCobranca = null;
    let isFirebaseConnected = false;
    let currentUser = null;

    // ========================================
    // ELEMENTOS DO DOM
    // ========================================
    const sidebar = document.getElementById('sidebar');
    const sidebarToggleBtn = document.getElementById('sidebar-toggle-btn');
    const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
    const sidebarOverlay = document.getElementById('sidebar-overlay');
    const menuItems = document.querySelectorAll('.menu-item');
    
    const connectionStatusEl = document.getElementById('connection-status');
    const loadingState = document.getElementById('loading-state');
    
    // Formulário de Cliente
    const clienteForm = document.getElementById('cliente-form');
    const cancelClienteBtn = document.getElementById('cancel-cliente-btn');
    const submitClienteBtn = document.getElementById('submit-cliente-btn');
    const formClienteTitle = document.getElementById('form-cliente-title');
    
    // Formulário de Cobrança
    const cobrancaForm = document.getElementById('cobranca-form');
    const stepSelecionarCliente = document.getElementById('step-selecionar-cliente');
    const stepDadosCobranca = document.getElementById('step-dados-cobranca');
    const clientesParaCobrancaDiv = document.getElementById('clientes-para-cobranca');
    const clienteSelecionadoInfo = document.getElementById('cliente-selecionado-info');

    // ========================================
    // FUNÇÕES DE NOTIFICAÇÃO (TOAST)
    // ========================================
    function showToast(message, type = 'success', duration = 4000) {
      const toastContainer = document.getElementById('toast-container');
      const toast = document.createElement('div');
      
      const icons = {
        success: 'fas fa-check-circle',
        error: 'fas fa-exclamation-circle',
        warning: 'fas fa-exclamation-triangle',
        info: 'fas fa-info-circle'
      };

      toast.className = `toast ${type}`;
      toast.innerHTML = `
        <i class="${icons[type]}"></i>
        <span>${message}</span>
        <button class="toast-close" onclick="this.parentElement.remove()">
          <i class="fas fa-times"></i>
        </button>
      `;

      toastContainer.appendChild(toast);
      setTimeout(() => toast.classList.add('show'), 100);
      
      setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => toast.remove(), 400);
      }, duration);
    }

    // ========================================
    // FUNÇÕES DE CONEXÃO
    // ========================================
    function updateConnectionStatus(status, message) {
      connectionStatusEl.className = `connection-status ${status}`;
      connectionStatusEl.innerHTML = `
        <i class="fas ${status === 'connected' ? 'fa-wifi' : status === 'disconnected' ? 'fa-wifi-slash' : 'fa-spinner fa-spin'}"></i>
        <span>${message}</span>
      `;
      
      if (status === 'connected') {
        setTimeout(() => {
          connectionStatusEl.style.opacity = '0';
          setTimeout(() => connectionStatusEl.style.display = 'none', 300);
        }, 2000);
      }
    }

    async function testFirebaseConnection() {
      updateConnectionStatus('connecting', 'Verificando conexão...');
      
      try {
        await db.collection('clientes').limit(1).get();
        isFirebaseConnected = true;
        updateConnectionStatus('connected', 'Conectado');
        return true;
      } catch (error) {
        console.error('Erro na conexão:', error);
        isFirebaseConnected = false;
        updateConnectionStatus('disconnected', 'Desconectado');
        return false;
      }
    }

    // ========================================
    // FUNÇÕES DE NAVEGAÇÃO E SIDEBAR
    // ========================================
    function mudarView(viewName) {
      // Remove classe active de todas as views
      document.querySelectorAll('.view').forEach(view => {
        view.classList.remove('active');
      });
      
      // Ativa a view selecionada
      const targetView = document.getElementById(`view-${viewName}`);
      if (targetView) {
        targetView.classList.add('active');
      }
      
      // Atualiza menu items
      menuItems.forEach(item => {
        item.classList.remove('active');
        if (item.getAttribute('data-view') === viewName) {
          item.classList.add('active');
        }
      });

      // Fecha menu mobile se estiver aberto
      if (window.innerWidth <= 768) {
        sidebar.classList.remove('mobile-open');
        sidebarOverlay.classList.remove('active');
      }

      // Carrega dados específicos da view
      if (viewName === 'nova-cobranca') {
        carregarClientesParaCobranca();
      } else if (viewName === 'lista-clientes') {
        renderizarListaClientes();
      } else if (viewName === 'cobrancas') {
        renderizarCobrancas();
      } else if (viewName === 'dashboard') {
        atualizarEstatisticas();
      }
    }

    // Toggle Sidebar Desktop
    sidebarToggleBtn.addEventListener('click', function() {
      sidebar.classList.toggle('collapsed');
      const icon = this.querySelector('i');
      if (sidebar.classList.contains('collapsed')) {
        icon.className = 'fas fa-angle-right';
      } else {
        icon.className = 'fas fa-angle-left';
      }
    });

    // Toggle Menu Mobile
    mobileMenuToggle.addEventListener('click', function() {
      sidebar.classList.toggle('mobile-open');
      sidebarOverlay.classList.toggle('active');
    });

    // Fecha menu ao clicar no overlay
    sidebarOverlay.addEventListener('click', function() {
      sidebar.classList.remove('mobile-open');
      sidebarOverlay.classList.remove('active');
    });

    // Event listeners dos menu items
    menuItems.forEach(item => {
      item.addEventListener('click', function(e) {
        const viewName = this.getAttribute('data-view');
        if (viewName) {
          e.preventDefault();
          mudarView(viewName);
        }
      });
    });

    // Função para voltar ao painel
    function voltarParaPainel() {
      window.location.href = 'finance.html';
    }

    // ========================================
    // FUNÇÕES DE FORMATAÇÃO
    // ========================================
    function formatarMoeda(valor) {
      return new Intl.NumberFormat('pt-BR', {
        style: 'currency',
        currency: 'BRL'
      }).format(valor);
    }

    function formatarData(data) {
      return new Date(data + 'T00:00:00').toLocaleDateString('pt-BR');
    }

    function formatarTelefone(telefone) {
      if (!telefone) return '-';
      // Remove tudo que não é número
      const numero = telefone.replace(/\D/g, '');
      
      // Formata conforme o tamanho
      if (numero.length === 11) {
        return numero.replace(/(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
      } else if (numero.length === 10) {
        return numero.replace(/(\d{2})(\d{4})(\d{4})/, '($1) $2-$3');
      }
      return telefone;
    }

    function formatarCPFCNPJ(doc) {
      if (!doc) return '-';
      const numero = doc.replace(/\D/g, '');
      
      if (numero.length === 11) {
        // CPF
        return numero.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
      } else if (numero.length === 14) {
        // CNPJ
        return numero.replace(/(\d{2})(\d{3})(\d{3})(\d{4})(\d{2})/, '$1.$2.$3/$4-$5');
      }
      return doc;
    }

    function calcularStatus(vencimento, isPago) {
      if (isPago) return 'pago';
      
      const hoje = new Date();
      hoje.setHours(0, 0, 0, 0);
      
      const dataVencimento = new Date(vencimento + 'T00:00:00');
      const diffTime = dataVencimento - hoje;
      const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
      
      if (diffDays < 0) return 'atrasado';
      if (diffDays <= 3) return 'pendente';
      return 'pendente';
    }

    function renderStatus(status) {
      const badges = {
        'pago': '<span class="status-badge pago"><i class="fas fa-check"></i> Pago</span>',
        'pendente': '<span class="status-badge pendente"><i class="fas fa-clock"></i> Pendente</span>',
        'atrasado': '<span class="status-badge atrasado"><i class="fas fa-exclamation"></i> Atrasado</span>'
      };
      return badges[status] || badges['pendente'];
    }

    // ========================================
    // AUTENTICAÇÃO FIREBASE
    // ========================================
    auth.onAuthStateChanged(async (user) => {
      if (user) {
        currentUser = user;
        console.log('✅ Usuário autenticado:', currentUser.uid);
        
        const connected = await testFirebaseConnection();
        if (connected) {
          await loadClientes();
          await loadCobrancas();
          atualizarEstatisticas();
        }
      } else {
        currentUser = null;
        console.log('⚠️ Usuário não autenticado - redirecionando...');
        window.location.href = 'cliente.html';
      }
    });

    // Continue na PARTE 7...
    // ========================================
    // FUNÇÕES DE CLIENTES - CARREGAR
    // ========================================
    async function loadClientes() {
      if (!isFirebaseConnected || !currentUser) {
        console.log('❌ Não pode carregar: Firebase conectado?', isFirebaseConnected, 'User?', !!currentUser);
        clientes = [];
        filteredClientes = [];
        return;
      }

      loadingState.classList.remove("hidden");
      
      try {
        console.log('🔍 Configurando listener em tempo real para clientes - userId:', currentUser.uid);
        
        // LISTENER EM TEMPO REAL - atualiza automaticamente quando há mudanças
        db.collection("clientes")
          .where("userId", "==", currentUser.uid)
          .orderBy("timestamp", "desc")
          .onSnapshot((snapshot) => {
            console.log('📦 Atualização de clientes recebida! Total:', snapshot.size);

            clientes = [];
            snapshot.forEach(doc => {
              const data = doc.data();
              clientes.push({
                id: doc.id,
                ...data
              });
            });

            console.log('✅ Total de clientes carregados:', clientes.length);

            filteredClientes = [...clientes];
            atualizarEstatisticas();
            
            // Atualiza views que dependem de clientes
            const activeView = document.querySelector('.view.active');
            if (activeView) {
              const viewId = activeView.id;
              if (viewId === 'view-lista-clientes') {
                renderizarListaClientes();
              } else if (viewId === 'view-nova-cobranca') {
                carregarClientesParaCobranca();
              }
            }
            
            loadingState.classList.add("hidden");
            
            if (clientes.length > 0 && snapshot.docChanges().length > 0) {
              const change = snapshot.docChanges()[0];
              if (change.type === 'added' && !change.doc.metadata.hasPendingWrites) {
                if (snapshot.docChanges().length === 1) {
                  showToast(`${clientes.length} clientes no sistema`, 'info', 2000);
                }
              }
            }
          }, (error) => {
            console.error('❌ Erro no listener de clientes:', error);
            
            if (error.code === 'permission-denied') {
              showToast('Sem permissão para acessar clientes', 'error');
            } else if (error.code === 'failed-precondition') {
              showToast('Índice necessário. Verifique o console do Firebase.', 'error');
              console.log('🔗 Crie o índice em: https://console.firebase.google.com/');
            } else {
              showToast('Erro ao carregar clientes: ' + error.message, 'error');
            }
            
            clientes = [];
            filteredClientes = [];
            loadingState.classList.add("hidden");
          });

      } catch (error) {
        console.error('❌ Erro ao configurar listener de clientes:', error);
        showToast('Erro ao configurar sincronização de clientes', 'error');
        clientes = [];
        filteredClientes = [];
        loadingState.classList.add("hidden");
      }
    }

    // ========================================
    // FUNÇÕES DE CLIENTES - SALVAR
    // ========================================
    clienteForm.addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const clienteData = {
        nome: document.getElementById('nome').value.trim(),
        empresa: document.getElementById('empresa').value.trim(),
        cpfCnpj: document.getElementById('cpf-cnpj').value.trim(),
        segmento: document.getElementById('segmento').value.trim(),
        telefone: document.getElementById('telefone').value.trim(),
        email: document.getElementById('email').value.trim(),
        cep: document.getElementById('cep').value.trim(),
        rua: document.getElementById('rua').value.trim(),
        numero: document.getElementById('numero').value.trim(),
        bairro: document.getElementById('bairro').value.trim(),
        cidade: document.getElementById('cidade').value.trim(),
        estado: document.getElementById('estado').value,
        observacoes: document.getElementById('observacoes').value.trim()
      };

      if (!isFirebaseConnected || !currentUser) {
        showToast('Você precisa estar autenticado', 'warning');
        return;
      }

      submitClienteBtn.disabled = true;

      try {
        const clienteId = document.getElementById('cliente-id').value;
        
        if (clienteEditando && clienteId) {
          // Editar cliente existente
          clienteData.userId = currentUser.uid;
          clienteData.timestamp = Date.now();
          
          await db.collection("clientes").doc(clienteId).update(clienteData);
          
          showToast('Cliente atualizado com sucesso!', 'success');
        } else {
          // Adicionar novo cliente
          clienteData.userId = currentUser.uid;
          clienteData.timestamp = Date.now();
          
          await db.collection("clientes").add(clienteData);
          
          showToast('Cliente cadastrado com sucesso!', 'success');
        }

        // Limpar formulário e resetar estado
        clienteForm.reset();
        document.getElementById('cliente-id').value = '';
        clienteEditando = null;
        cancelarEdicaoCliente();
        
      } catch (error) {
        console.error('Erro ao salvar cliente:', error);
        
        if (error.code === 'permission-denied') {
          showToast('Sem permissão para salvar cliente', 'error');
        } else {
          showToast('Erro ao salvar cliente', 'error');
        }
      } finally {
        submitClienteBtn.disabled = false;
      }
    });

    // ========================================
    // FUNÇÕES DE CLIENTES - EDITAR/CANCELAR
    // ========================================
    function editarCliente(id) {
      const cliente = clientes.find(c => c.id === id);
      if (!cliente) return;
      
      clienteEditando = cliente;
      
      // Mudar para a view de cadastro
      mudarView('cadastrar-cliente');
      
      // Preencher formulário
      document.getElementById('cliente-id').value = cliente.id;
      document.getElementById('nome').value = cliente.nome || '';
      document.getElementById('empresa').value = cliente.empresa || '';
      document.getElementById('cpf-cnpj').value = cliente.cpfCnpj || '';
      document.getElementById('segmento').value = cliente.segmento || '';
      document.getElementById('telefone').value = cliente.telefone || '';
      document.getElementById('email').value = cliente.email || '';
      document.getElementById('cep').value = cliente.cep || '';
      document.getElementById('rua').value = cliente.rua || '';
      document.getElementById('numero').value = cliente.numero || '';
      document.getElementById('bairro').value = cliente.bairro || '';
      document.getElementById('cidade').value = cliente.cidade || '';
      document.getElementById('estado').value = cliente.estado || '';
      document.getElementById('observacoes').value = cliente.observacoes || '';
      
      formClienteTitle.textContent = 'Editar Cliente';
      submitClienteBtn.innerHTML = '<i class="fas fa-save"></i> Salvar Alterações';
      cancelClienteBtn.style.display = 'inline-flex';
      
      // Scroll suave para o topo
      window.scrollTo({ top: 0, behavior: 'smooth' });
      
      showToast('Editando cliente: ' + cliente.nome, 'info');
    }

    function cancelarEdicaoCliente() {
      clienteForm.reset();
      document.getElementById('cliente-id').value = '';
      clienteEditando = null;
      formClienteTitle.textContent = 'Cadastrar Novo Cliente';
      submitClienteBtn.innerHTML = '<i class="fas fa-check"></i> Cadastrar Cliente';
      cancelClienteBtn.style.display = 'none';
    }

    cancelClienteBtn.addEventListener('click', cancelarEdicaoCliente);

    // ========================================
    // FUNÇÕES DE CLIENTES - EXCLUIR
    // ========================================
    async function excluirCliente(id) {
      const cliente = clientes.find(c => c.id === id);
      if (!cliente) return;
      
      if (!confirm(`Deseja realmente excluir o cliente ${cliente.nome}?\n\nAtenção: Todas as cobranças deste cliente também serão excluídas!`)) {
        return;
      }

      if (!isFirebaseConnected || !currentUser) {
        showToast('Você precisa estar autenticado', 'error');
        return;
      }

      try {
        // Excluir cliente
        await db.collection("clientes").doc(id).delete();
        
        // Excluir todas as cobranças deste cliente
        const cobrancasDoCliente = await db.collection("cobrancas")
          .where("userId", "==", currentUser.uid)
          .where("clienteId", "==", id)
          .get();
        
        const batch = db.batch();
        cobrancasDoCliente.forEach(doc => {
          batch.delete(doc.ref);
        });
        await batch.commit();
        
        showToast('Cliente e cobranças excluídos com sucesso!', 'warning', 2000);
      } catch (error) {
        console.error('Erro ao excluir cliente:', error);
        
        if (error.code === 'permission-denied') {
          showToast('Sem permissão para excluir cliente', 'error');
        } else {
          showToast('Erro ao excluir cliente', 'error');
        }
      }
    }

    // ========================================
    // FUNÇÕES DE CLIENTES - RENDERIZAR LISTA
    // ========================================
    function renderizarListaClientes() {
      const tbody = document.getElementById('clientes-lista-tbody');
      const emptyState = document.getElementById('empty-clientes-lista');
      const table = document.getElementById('clientes-lista-table');
      
      tbody.innerHTML = '';

      // Aplicar busca
      const termoBusca = document.getElementById('search-clientes-lista').value.toLowerCase();
      
      filteredClientes = clientes.filter(cliente => {
        if (termoBusca) {
          return cliente.nome.toLowerCase().includes(termoBusca) || 
                 cliente.empresa.toLowerCase().includes(termoBusca);
        }
        return true;
      });

      if (filteredClientes.length === 0) {
        table.style.display = 'none';
        emptyState.classList.remove('hidden');
        return;
      }

      table.style.display = 'table';
      emptyState.classList.add('hidden');

      filteredClientes.forEach(cliente => {
        const row = document.createElement('tr');
        const cidadeEstado = [cliente.cidade, cliente.estado].filter(Boolean).join(' - ') || '-';
        
        row.innerHTML = `
          <td>
            <strong>${cliente.nome}</strong>
            ${cliente.observacoes ? `<br><small style="color: var(--text-gray);">${cliente.observacoes}</small>` : ''}
          </td>
          <td>${cliente.empresa}</td>
          <td>${formatarCPFCNPJ(cliente.cpfCnpj)}</td>
          <td>${formatarTelefone(cliente.telefone)}</td>
          <td>${cliente.email || '-'}</td>
          <td>${cidadeEstado}</td>
          <td>
            <div class="action-buttons">
              <button class="btn btn-info btn-small" onclick="editarCliente('${cliente.id}')" title="Editar">
                <i class="fas fa-edit"></i>
              </button>
              <button class="btn btn-success btn-small" onclick="contatarWhatsApp('${cliente.telefone}', '${cliente.nome}')" title="WhatsApp">
                <i class="fab fa-whatsapp"></i>
              </button>
              <button class="btn btn-danger btn-small" onclick="excluirCliente('${cliente.id}')" title="Excluir">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    function buscarClientesLista() {
      renderizarListaClientes();
      const termo = document.getElementById('search-clientes-lista').value;
      if (termo) {
        showToast(`Buscando por: ${termo}`, 'info', 1500);
      }
    }

    // ========================================
    // FUNÇÃO DE CONTATO WHATSAPP
    // ========================================
    function contatarWhatsApp(telefone, nome, valor = null, vencimento = null) {
      const numeroLimpo = telefone.replace(/\D/g, '');
      const numeroFormatado = numeroLimpo.startsWith('55') ? numeroLimpo : '55' + numeroLimpo;
      
      let mensagem = `Olá ${nome}! 👋\n\n`;
      
      if (valor && vencimento) {
        mensagem += `Este é um lembrete sobre o pagamento do serviço prestado.\n\n💰 Valor: ${formatarMoeda(valor)}\n📅 Vencimento: ${formatarData(vencimento)}\n\nPor favor, entre em contato caso tenha alguma dúvida.\n\n`;
      } else {
        mensagem += `Como posso ajudá-lo(a) hoje?\n\n`;
      }
      
      mensagem += `Atenciosamente,\nDev Digital BR`;
      
      const mensagemCodificada = encodeURIComponent(mensagem);
      window.open(`https://wa.me/${numeroFormatado}?text=${mensagemCodificada}`, '_blank');
      
      showToast('Abrindo WhatsApp...', 'info', 1500);
    }

    // Continue na PARTE 8...
    // ========================================
    // FUNÇÕES DE COBRANÇAS - CARREGAR
    // ========================================
    async function loadCobrancas() {
      if (!isFirebaseConnected || !currentUser) {
        console.log('❌ Não pode carregar cobranças');
        cobrancas = [];
        filteredCobrancas = [];
        return;
      }

      try {
        console.log('🔍 Configurando listener em tempo real para cobranças - userId:', currentUser.uid);
        
        db.collection("cobrancas")
          .where("userId", "==", currentUser.uid)
          .orderBy("timestamp", "desc")
          .onSnapshot((snapshot) => {
            console.log('📦 Atualização de cobranças recebida! Total:', snapshot.size);

            cobrancas = [];
            snapshot.forEach(doc => {
              const data = doc.data();
              cobrancas.push({
                id: doc.id,
                ...data
              });
            });

            console.log('✅ Total de cobranças carregadas:', cobrancas.length);

            filteredCobrancas = [...cobrancas];
            atualizarEstatisticas();
            
            // Atualiza view de cobranças se estiver ativa
            const activeView = document.querySelector('.view.active');
            if (activeView && activeView.id === 'view-cobrancas') {
              renderizarCobrancas();
            }
            
          }, (error) => {
            console.error('❌ Erro no listener de cobranças:', error);
            
            if (error.code === 'permission-denied') {
              showToast('Sem permissão para acessar cobranças', 'error');
            } else if (error.code === 'failed-precondition') {
              showToast('Índice necessário para cobranças.', 'error');
              console.log('🔗 Crie o índice em: https://console.firebase.google.com/');
            } else {
              showToast('Erro ao carregar cobranças: ' + error.message, 'error');
            }
            
            cobrancas = [];
            filteredCobrancas = [];
          });

      } catch (error) {
        console.error('❌ Erro ao configurar listener de cobranças:', error);
        showToast('Erro ao configurar sincronização de cobranças', 'error');
        cobrancas = [];
        filteredCobrancas = [];
      }
    }

    // ========================================
    // FUNÇÕES DE COBRANÇAS - NOVA COBRANÇA
    // ========================================
    function carregarClientesParaCobranca() {
      clientesParaCobrancaDiv.innerHTML = '';
      const emptyState = document.getElementById('empty-clientes-cobranca');
      
      // Aplicar busca
      const termoBusca = document.getElementById('search-cliente-cobranca').value.toLowerCase();
      
      let clientesFiltrados = clientes;
      if (termoBusca) {
        clientesFiltrados = clientes.filter(cliente => {
          return cliente.nome.toLowerCase().includes(termoBusca) || 
                 cliente.empresa.toLowerCase().includes(termoBusca);
        });
      }

      if (clientesFiltrados.length === 0) {
        emptyState.classList.remove('hidden');
        clientesParaCobrancaDiv.style.display = 'none';
        return;
      }

      emptyState.classList.add('hidden');
      clientesParaCobrancaDiv.style.display = 'grid';

      clientesFiltrados.forEach(cliente => {
        const card = document.createElement('div');
        card.className = 'cliente-card';
        card.onclick = () => selecionarClienteParaCobranca(cliente);
        
        card.innerHTML = `
          <div class="cliente-card-header">
            <div>
              <div class="cliente-card-title">${cliente.nome}</div>
              <div class="cliente-card-empresa">${cliente.empresa}</div>
            </div>
          </div>
          <div class="cliente-card-info">
            <div><i class="fas fa-phone"></i> ${formatarTelefone(cliente.telefone)}</div>
            ${cliente.email ? `<div><i class="fas fa-envelope"></i> ${cliente.email}</div>` : ''}
            ${cliente.cidade ? `<div><i class="fas fa-map-marker-alt"></i> ${cliente.cidade}${cliente.estado ? ' - ' + cliente.estado : ''}</div>` : ''}
          </div>
        `;
        
        clientesParaCobrancaDiv.appendChild(card);
      });
    }

    function buscarClientesParaCobranca() {
      carregarClientesParaCobranca();
    }

    function selecionarClienteParaCobranca(cliente) {
      clienteSelecionadoParaCobranca = cliente;
      
      // Mostrar informações do cliente selecionado
      clienteSelecionadoInfo.innerHTML = `
        <div><strong>${cliente.nome}</strong> - ${cliente.empresa}</div>
        <div style="font-size: 0.9rem; color: var(--text-gray); margin-top: 0.3rem;">
          <i class="fas fa-phone"></i> ${formatarTelefone(cliente.telefone)}
          ${cliente.email ? ` | <i class="fas fa-envelope"></i> ${cliente.email}` : ''}
        </div>
      `;
      
      document.getElementById('cobranca-cliente-id').value = cliente.id;
      
      // Esconder seleção de cliente e mostrar formulário
      stepSelecionarCliente.classList.add('hidden');
      stepDadosCobranca.classList.remove('hidden');
      
      showToast('Cliente selecionado: ' + cliente.nome, 'success', 2000);
    }

    function voltarSelecaoCliente() {
      clienteSelecionadoParaCobranca = null;
      document.getElementById('cobranca-cliente-id').value = '';
      
      stepSelecionarCliente.classList.remove('hidden');
      stepDadosCobranca.classList.add('hidden');
      
      cobrancaForm.reset();
    }

    function cancelarCobranca() {
      cobrancaForm.reset();
      voltarSelecaoCliente();
      showToast('Cobrança cancelada', 'info', 2000);
    }

    // ========================================
    // FUNÇÕES DE COBRANÇAS - SALVAR
    // ========================================
    cobrancaForm.addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const cobrancaData = {
        clienteId: document.getElementById('cobranca-cliente-id').value,
        clienteNome: clienteSelecionadoParaCobranca.nome,
        clienteEmpresa: clienteSelecionadoParaCobranca.empresa,
        clienteTelefone: clienteSelecionadoParaCobranca.telefone,
        servico: document.getElementById('cobranca-servico').value.trim(),
        valor: parseFloat(document.getElementById('cobranca-valor').value),
        vencimento: document.getElementById('cobranca-vencimento').value,
        formaPagamento: document.getElementById('cobranca-forma-pagamento').value,
        status: document.getElementById('cobranca-status').value,
        observacoes: document.getElementById('cobranca-observacoes').value.trim(),
        isPago: document.getElementById('cobranca-status').value === 'pago'
      };

      if (!isFirebaseConnected || !currentUser) {
        showToast('Você precisa estar autenticado', 'warning');
        return;
      }

      const submitBtn = document.getElementById('submit-cobranca-btn');
      submitBtn.disabled = true;

      try {
        const cobrancaId = document.getElementById('cobranca-id').value;
        
        if (cobrancaEditando && cobrancaId) {
          // Editar cobrança existente
          cobrancaData.userId = currentUser.uid;
          cobrancaData.timestamp = Date.now();
          
          await db.collection("cobrancas").doc(cobrancaId).update(cobrancaData);
          
          showToast('Cobrança atualizada com sucesso!', 'success');
        } else {
          // Adicionar nova cobrança
          cobrancaData.userId = currentUser.uid;
          cobrancaData.timestamp = Date.now();
          
          await db.collection("cobrancas").add(cobrancaData);
          
          showToast('Cobrança criada com sucesso!', 'success');
        }

        // Limpar e resetar
        cobrancaForm.reset();
        document.getElementById('cobranca-id').value = '';
        cobrancaEditando = null;
        voltarSelecaoCliente();
        
      } catch (error) {
        console.error('Erro ao salvar cobrança:', error);
        
        if (error.code === 'permission-denied') {
          showToast('Sem permissão para salvar cobrança', 'error');
        } else {
          showToast('Erro ao salvar cobrança', 'error');
        }
      } finally {
        submitBtn.disabled = false;
      }
    });

    // ========================================
    // FUNÇÕES DE COBRANÇAS - RENDERIZAR
    // ========================================
    function renderizarCobrancas() {
      const tbody = document.getElementById('cobrancas-tbody');
      const emptyState = document.getElementById('empty-cobrancas');
      const table = document.getElementById('cobrancas-table');
      
      tbody.innerHTML = '';

      // Aplicar filtros
      const statusFiltro = document.getElementById('filter-status-cobranca').value;
      const termoBusca = document.getElementById('search-cobrancas').value.toLowerCase();
      
      filteredCobrancas = cobrancas.filter(cobranca => {
        let matchesStatus = true;
        let matchesSearch = true;
        
        if (statusFiltro) {
          const status = calcularStatus(cobranca.vencimento, cobranca.isPago);
          matchesStatus = status === statusFiltro;
        }
        
        if (termoBusca) {
          matchesSearch = cobranca.clienteNome.toLowerCase().includes(termoBusca) || 
                         cobranca.clienteEmpresa.toLowerCase().includes(termoBusca) ||
                         cobranca.servico.toLowerCase().includes(termoBusca);
        }
        
        return matchesStatus && matchesSearch;
      });

      if (filteredCobrancas.length === 0) {
        table.style.display = 'none';
        emptyState.classList.remove('hidden');
        return;
      }

      table.style.display = 'table';
      emptyState.classList.add('hidden');

      // Ordenar por data de vencimento
      filteredCobrancas.sort((a, b) => new Date(a.vencimento) - new Date(b.vencimento));

      filteredCobrancas.forEach(cobranca => {
        const status = calcularStatus(cobranca.vencimento, cobranca.isPago);
        const btnPagoClass = cobranca.isPago ? 'btn-success' : 'btn-warning';
        const btnPagoIcon = cobranca.isPago ? 'fa-check-circle' : 'fa-circle';
        const btnPagoText = cobranca.isPago ? 'Pago' : 'Marcar Pago';

        const row = document.createElement('tr');
        row.innerHTML = `
          <td>
            <strong>${cobranca.clienteNome}</strong>
            ${cobranca.observacoes ? `<br><small style="color: var(--text-gray);">${cobranca.observacoes}</small>` : ''}
          </td>
          <td>${cobranca.clienteEmpresa}</td>
          <td>${cobranca.servico}</td>
          <td style="font-weight:700;"><strong>${formatarMoeda(cobranca.valor)}</strong></td>
          <td>${cobranca.formaPagamento.replace('-', ' ').toUpperCase()}</td>
          <td>${formatarData(cobranca.vencimento)}</td>
          <td>${renderStatus(status)}</td>
          <td>
            <div class="action-buttons">
              <button class="btn ${btnPagoClass} btn-small" onclick="marcarComoPago('${cobranca.id}')" title="${btnPagoText}">
                <i class="fas ${btnPagoIcon}"></i>
              </button>
              <button class="btn btn-info btn-small" onclick="editarCobranca('${cobranca.id}')" title="Editar">
                <i class="fas fa-edit"></i>
              </button>
              <button class="btn btn-success btn-small" onclick="contatarWhatsApp('${cobranca.clienteTelefone}', '${cobranca.clienteNome}', ${cobranca.valor}, '${cobranca.vencimento}')" title="WhatsApp">
                <i class="fab fa-whatsapp"></i>
              </button>
              <button class="btn btn-danger btn-small" onclick="excluirCobranca('${cobranca.id}')" title="Excluir">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    function filtrarCobrancas() {
      renderizarCobrancas();
    }

    function buscarCobrancas() {
      renderizarCobrancas();
      const termo = document.getElementById('search-cobrancas').value;
      if (termo) {
        showToast(`Buscando por: ${termo}`, 'info', 1500);
      }
    }

    // ========================================
    // FUNÇÕES DE COBRANÇAS - EDITAR
    // ========================================
    function editarCobranca(id) {
      const cobranca = cobrancas.find(c => c.id === id);
      if (!cobranca) return;
      
      cobrancaEditando = cobranca;
      
      // Buscar dados completos do cliente
      const cliente = clientes.find(c => c.id === cobranca.clienteId);
      if (!cliente) {
        showToast('Cliente não encontrado', 'error');
        return;
      }
      
      // Mudar para view de nova cobrança
      mudarView('nova-cobranca');
      
      // Selecionar cliente automaticamente
      selecionarClienteParaCobranca(cliente);
      
      // Preencher formulário
      document.getElementById('cobranca-id').value = cobranca.id;
      document.getElementById('cobranca-servico').value = cobranca.servico || '';
      document.getElementById('cobranca-valor').value = cobranca.valor || '';
      document.getElementById('cobranca-vencimento').value = cobranca.vencimento || '';
      document.getElementById('cobranca-forma-pagamento').value = cobranca.formaPagamento || '';
      document.getElementById('cobranca-status').value = cobranca.status || 'pendente';
      document.getElementById('cobranca-observacoes').value = cobranca.observacoes || '';
      
      document.getElementById('submit-cobranca-btn').innerHTML = '<i class="fas fa-save"></i> Salvar Alterações';
      
      showToast('Editando cobrança', 'info');
    }

    // ========================================
    // FUNÇÕES DE COBRANÇAS - EXCLUIR
    // ========================================
    async function excluirCobranca(id) {
      const cobranca = cobrancas.find(c => c.id === id);
      if (!cobranca) return;
      
      if (!confirm(`Deseja realmente excluir esta cobrança?\n\nCliente: ${cobranca.clienteNome}\nServiço: ${cobranca.servico}\nValor: ${formatarMoeda(cobranca.valor)}`)) {
        return;
      }

      if (!isFirebaseConnected || !currentUser) {
        showToast('Você precisa estar autenticado', 'error');
        return;
      }

      try {
        await db.collection("cobrancas").doc(id).delete();
        showToast('Cobrança excluída com sucesso!', 'warning', 2000);
      } catch (error) {
        console.error('Erro ao excluir cobrança:', error);
        
        if (error.code === 'permission-denied') {
          showToast('Sem permissão para excluir cobrança', 'error');
        } else {
          showToast('Erro ao excluir cobrança', 'error');
        }
      }
    }

    // ========================================
    // FUNÇÕES DE COBRANÇAS - MARCAR COMO PAGO
    // ========================================
    async function marcarComoPago(id) {
      const cobranca = cobrancas.find(c => c.id === id);
      if (!cobranca) return;

      if (!isFirebaseConnected || !currentUser) {
        showToast('Você precisa estar autenticado', 'error');
        return;
      }

      try {
        const novoStatus = !cobranca.isPago;
        
        await db.collection("cobrancas").doc(id).update({
          isPago: novoStatus,
          status: novoStatus ? 'pago' : 'pendente'
        });
        
        if (novoStatus) {
          showToast(`Pagamento marcado como PAGO!`, 'success');
        } else {
          showToast(`Pagamento marcado como PENDENTE!`, 'warning');
        }
      } catch (error) {
        console.error('Erro ao atualizar status:', error);
        showToast('Erro ao atualizar status de pagamento', 'error');
      }
    }

    // Continue na PARTE 9...
    // ========================================
    // FUNÇÕES DE ESTATÍSTICAS
    // ========================================
    function atualizarEstatisticas() {
      // Estatísticas de clientes
      const totalClientes = clientes.length;
      document.getElementById('total-clientes').textContent = totalClientes;
      
      // Estatísticas de cobranças
      let pagos = 0;
      let pendentes = 0;
      let atrasados = 0;

      cobrancas.forEach(cobranca => {
        const status = calcularStatus(cobranca.vencimento, cobranca.isPago);
        if (status === 'pago') pagos++;
        else if (status === 'pendente') pendentes++;
        else if (status === 'atrasado') atrasados++;
      });

      document.getElementById('clientes-pagos').textContent = pagos;
      document.getElementById('clientes-pendentes').textContent = pendentes;
      document.getElementById('clientes-atrasados').textContent = atrasados;
    }

    // ========================================
    // MÁSCARAS DE ENTRADA (OPCIONAL)
    // ========================================
    // Máscara para Telefone
    document.getElementById('telefone').addEventListener('input', function(e) {
      let value = e.target.value.replace(/\D/g, '');
      
      if (value.length <= 11) {
        if (value.length <= 10) {
          value = value.replace(/(\d{2})(\d{4})(\d{4})/, '($1) $2-$3');
        } else {
          value = value.replace(/(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
        }
      }
      
      e.target.value = value;
    });

    // Máscara para CPF/CNPJ
    document.getElementById('cpf-cnpj').addEventListener('input', function(e) {
      let value = e.target.value.replace(/\D/g, '');
      
      if (value.length <= 11) {
        // CPF
        value = value.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
      } else if (value.length <= 14) {
        // CNPJ
        value = value.replace(/(\d{2})(\d{3})(\d{3})(\d{4})(\d{2})/, '$1.$2.$3/$4-$5');
      }
      
      e.target.value = value;
    });

    // Máscara para CEP
    document.getElementById('cep').addEventListener('input', function(e) {
      let value = e.target.value.replace(/\D/g, '');
      
      if (value.length <= 8) {
        value = value.replace(/(\d{5})(\d{3})/, '$1-$2');
      }
      
      e.target.value = value;
    });

    // Busca de CEP (opcional - integração com ViaCEP)
    document.getElementById('cep').addEventListener('blur', async function(e) {
      const cep = e.target.value.replace(/\D/g, '');
      
      if (cep.length === 8) {
        try {
          const response = await fetch(`https://viacep.com.br/ws/${cep}/json/`);
          const data = await response.json();
          
          if (!data.erro) {
            document.getElementById('rua').value = data.logradouro || '';
            document.getElementById('bairro').value = data.bairro || '';
            document.getElementById('cidade').value = data.localidade || '';
            document.getElementById('estado').value = data.uf || '';
            
            showToast('Endereço preenchido automaticamente!', 'success', 2000);
          }
        } catch (error) {
          console.log('Erro ao buscar CEP:', error);
        }
      }
    });

    // ========================================
    // VALIDAÇÕES E AJUSTES DE FORMULÁRIOS
    // ========================================
    // Define data mínima como hoje para vencimentos
    const hoje = new Date().toISOString().split('T')[0];
    document.getElementById('cobranca-vencimento').min = hoje;

    // Impede valores negativos nos campos de valor
    document.getElementById('cobranca-valor').addEventListener('input', function(e) {
      if (e.target.value < 0) {
        e.target.value = 0;
      }
    });

    // ========================================
    // FUNÇÕES GLOBAIS (para onclick no HTML)
    // ========================================
    window.mudarView = mudarView;
    window.voltarParaPainel = voltarParaPainel;
    window.editarCliente = editarCliente;
    window.excluirCliente = excluirCliente;
    window.contatarWhatsApp = contatarWhatsApp;
    window.buscarClientesLista = buscarClientesLista;
    window.buscarClientesParaCobranca = buscarClientesParaCobranca;
    window.selecionarClienteParaCobranca = selecionarClienteParaCobranca;
    window.voltarSelecaoCliente = voltarSelecaoCliente;
    window.cancelarCobranca = cancelarCobranca;
    window.editarCobranca = editarCobranca;
    window.excluirCobranca = excluirCobranca;
    window.marcarComoPago = marcarComoPago;
    window.filtrarCobrancas = filtrarCobrancas;
    window.buscarCobrancas = buscarCobrancas;

    // ========================================
    // INICIALIZAÇÃO DO SISTEMA
    // ========================================
    document.addEventListener('DOMContentLoaded', function() {
      console.log('🚀 Sistema de Controle de Clientes v2.0 - Dev Digital BR');
      console.log('✅ Firestore integrado com sucesso!');
      console.log('📊 Coleções: clientes e cobrancas (filtrado por userId)');
      
      // Inicializa na view Dashboard
      mudarView('dashboard');
      
      // Event listener para busca ao pressionar Enter
      document.getElementById('search-clientes-lista').addEventListener('keyup', function(e) {
        if (e.key === 'Enter') {
          buscarClientesLista();
        }
      });
      
      document.getElementById('search-cliente-cobranca').addEventListener('keyup', function(e) {
        if (e.key === 'Enter') {
          buscarClientesParaCobranca();
        } else {
          // Busca em tempo real enquanto digita
          carregarClientesParaCobranca();
        }
      });
      
      document.getElementById('search-cobrancas').addEventListener('keyup', function(e) {
        if (e.key === 'Enter') {
          buscarCobrancas();
        }
      });

      // Ajusta sidebar em mobile ao redimensionar
      window.addEventListener('resize', function() {
        if (window.innerWidth > 768) {
          sidebar.classList.remove('mobile-open');
          sidebarOverlay.classList.remove('active');
        }
      });
    });
  </script>
</body>
</html>
